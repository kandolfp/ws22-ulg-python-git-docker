<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
   <link rel="stylesheet" href="/ws22-ulg-python-git-docker/libs/highlight/github.min.css">
   
    <script src="/ws22-ulg-python-git-docker/libs/clipboard.min.js"></script>
  
  
  <script src="/ws22-ulg-python-git-docker/libs/plotly-1_58_5.min.js"></script> 
  <script>
    // This function is used when calling `\fig{...}` See # Using \fig{...} below
    const PlotlyJS_json = async (div, url) => {
      response = await fetch(url); // get file
      fig = await response.json(); // convert it to json
      // Make the plot fit the screen responsively. See the documentation of plotly.js. https://plotly.com/javascript/responsive-fluid-layout/
      if (typeof fig.config === 'undefined') { fig["config"]={} }
      delete fig.layout.width
      delete fig.layout.height
      fig["layout"]["autosize"] = true
      fig["config"]["autosizable"] = true
      fig["config"]["responsive"] = true

      // make it easier to scroll throught the website rather than being blocked by a figure.
      fig.config["scrollZoom"] = false

      // PlotlyJS.savefig by default add the some more attribute to make a static plot.
      // Disable them to make the website fancier.
      delete fig.config.staticPlot
      delete fig.config.displayModeBar
      delete fig.config.doubleClick
      delete fig.config.showTips

      Plotly.newPlot(div, fig);
    };
  </script>
  
  <link rel="stylesheet" href="/ws22-ulg-python-git-docker/css/jtd.css">
<link rel="stylesheet" href="/ws22-ulg-python-git-docker/css/extras.css">
<link rel="icon" href="/ws22-ulg-python-git-docker/assets/favicon.ico">

<style>
  /* #148 wrap long header */
  .franklin-content a.header-anchor,
  .franklin-toc li a
   {
    word-wrap: break-word;
    white-space: normal;
  }
</style>

   <title>Containerisation</title>  
</head>
<body>                      <!-- closed in foot.html -->
<div class="page-wrap">   <!-- closed in foot.html -->
  <!-- SIDE BAR -->
  <div class="side-bar">
    <div class="header">
      <a href="/ws22-ulg-python-git-docker/" class="title">
        ULG Software VU 2
      </a>
    </div>
    <label for="show-menu" class="show-menu">MENU</label>
    <input type="checkbox" id="show-menu" role="button">
    <div class="menu" id="side-menu">
      <ul class="menu-list">
        <li class="menu-list-item "><a href="/ws22-ulg-python-git-docker/" class="menu-list-link ">Start</a>
        <li class="menu-list-item "><a href="/ws22-ulg-python-git-docker/pages/python/" class="menu-list-link ">Python</a>
          <ul class="menu-list-child-list ">
            <li class="menu-list-item "><a href="/ws22-ulg-python-git-docker/pages/python/numpy/" class="menu-list-link ">NumPy</a>
              <ul class="menu-list-child-list ">
                <li class="menu-list-item "><a href="/ws22-ulg-python-git-docker/notebooks/html/Session1/" class="menu-list-link ">Session Notes</a>
              </ul>
            <li class="menu-list-item "><a href="/ws22-ulg-python-git-docker/pages/python/pandas/" class="menu-list-link ">Pandas</a>
              <ul class="menu-list-child-list ">
                <li class="menu-list-item "><a href="/ws22-ulg-python-git-docker/notebooks/html/Session2/" class="menu-list-link ">Session Notes</a>
              </ul>
          </ul>
           <li class="menu-list-item "><a href="/ws22-ulg-python-git-docker/pages/git/" class="menu-list-link ">Git</a>
          <ul class="menu-list-child-list ">
            <li class="menu-list-item "><a href="/ws22-ulg-python-git-docker/pages/git/basics/" class="menu-list-link ">Basics</a>
          </ul>
        <li class="menu-list-item active"><a href="/ws22-ulg-python-git-docker/pages/docker/" class="menu-list-link active">Docker</a>
          <ul class="menu-list-child-list ">
            <li class="menu-list-item "><a href="/ws22-ulg-python-git-docker/pages/docker/basics/" class="menu-list-link ">Basics</a>
          </ul>
        <li class="menu-list-item "><a href="/ws22-ulg-python-git-docker/pages/cicd/" class="menu-list-link ">CI/CD</a>  
      </ul>
    </div>
    <div class="footer">
      This is <em>Just the docs</em>, adapted from the <a href="https://github.com/pmarsceill/just-the-docs" target="_blank">Jekyll theme</a>.
    </div>
  </div>
  <!-- CONTENT -->
  <div class="main-content-wrap"> <!-- closed in foot.html -->
    <div class="main-content">    <!-- closed in foot.html -->
      <div class="main-header">
        ULG 971001 - Software (VU 2) - python, git, docker
      </div>



<!-- Content appended here (in class franklin-content) -->
<div class="franklin-content"><h1 id="basics_-_why_and_how"><a href="#basics_-_why_and_how" class="header-anchor">Basics - why and how?</a></h1>
<p>In this section we are going to talk about <em>containerisation</em> but before we can do that let us discuss some common issues in &#40;scientific&#41; computing</p>
<p>Table of content: <div class="franklin-toc"><ol><li><a href="#you_need_a_different_softwarelibrary_than_installed">You need a different software/library than installed</a></li><li><a href="#you_need_to_assure_reproducibility_iereproducible_science">You need to assure reproducibility &#40;i.e.~reproducible science&#41;</a></li><li><a href="#i_need_specific_software_dependencies_dependency_hell">I need specific software dependencies &#40;dependency hell&#41;</a></li><li><a href="#you_need_to_run_software_compiled_for_x_but_run_y">You need to run software compiled for X but run Y</a></li><li><a href="#you_need_to_test_your_software_for_x_but_you_run_y">You need to test your software for X but you run Y</a></li><li><a href="#you_have_no_rights_to_install_software_but_you_can_run_jobs_high_performance_computing">You have no rights to install software but you can run jobs &#40;High Performance Computing&#41;</a></li><li><a href="#you_need_to_share_your_software_but_how">You need to share your software but how?</a></li><li><a href="#you_need_to_archive_a_working_version_limited">You need to archive a working version &#40;limited&#41;</a></li><li><a href="#legacy_code_on_old_os">Legacy code on old OS</a></li><li><a href="#virtualisation">Virtualisation</a></li><li><a href="#containerisation">Containerisation</a></li></ol></div> </p>
<h2 id="you_need_a_different_softwarelibrary_than_installed"><a href="#you_need_a_different_softwarelibrary_than_installed" class="header-anchor">You need a different software/library than installed</a></h2>
<p>Quite often the software that is installed on a machine that you have access to or are allowed to work with does not have the specific library, software, software version that you need to work with.  Even more often you do not have the rights to install software at your own freedom on the machine and the admin takes quite long to install what you need. </p>
<h2 id="you_need_to_assure_reproducibility_iereproducible_science"><a href="#you_need_to_assure_reproducibility_iereproducible_science" class="header-anchor">You need to assure reproducibility &#40;i.e.~reproducible science&#41;</a></h2>
<p>Another frequent scenario is that you should always be able to reproduce your results.  This means that you need to be able to run the same experiments two, three or twenty years later.  Some reasons for this are:</p>
<ul>
<li><p>a client gets an error and you need to verify it with the version this client has</p>
</li>
<li><p>you switch operating system</p>
</li>
<li><p>the review process for a paper takes longer</p>
</li>
<li><p>you need to update a library or switch to a new library and you need to verify your results</p>
</li>
<li><p>you now work with library version <em>x</em> but you need to regenerate some input variable that still use version <em>y</em></p>
</li>
<li><p>you need to make sure that on <em>machine a</em> and <em>machine b</em> the results are the same</p>
</li>
</ul>
<h2 id="i_need_specific_software_dependencies_dependency_hell"><a href="#i_need_specific_software_dependencies_dependency_hell" class="header-anchor">I need specific software dependencies &#40;dependency hell&#41;</a></h2>
<p>If you haven not run into this problem by now you are either new to programming or just plain and simple lucky. </p>
<p>In programming languages like Python or Julia you usually work with a multitude of libraries depending on your needs.  It will come as no surprise to you that most of these libraries again depend on other libraries.  This vast ecosystem is constantly growing and quickly <em>library a</em> will depend on <em>library b</em> with <em>version y</em> while <em>library c</em> needs <em>version z</em> of <em>library b</em>.  As you can see it is already confusing to write down so actually sorting it out on your system is even more difficult.  While modern package managers have become better at this you will often still run into the so called <em>dependency hell</em>.   Now consider that most likely your code will start to have these issues as well if you move from one version of a library to the next and combine it with the above paint. </p>
<h2 id="you_need_to_run_software_compiled_for_x_but_run_y"><a href="#you_need_to_run_software_compiled_for_x_but_run_y" class="header-anchor">You need to run software compiled for X but run Y</a></h2>
<p>If you are running a windows machine but need to run some Linux software as there is no Windows version available.  Or maybe you have a new Apple with an Mx chip and still want to use some software that is compiled for x86. </p>
<h2 id="you_need_to_test_your_software_for_x_but_you_run_y"><a href="#you_need_to_test_your_software_for_x_but_you_run_y" class="header-anchor">You need to test your software for X but you run Y</a></h2>
<p>Maybe you are developing software on Windows but it should also run on Linux but it should also work on Android iOS and so forth.</p>
<h2 id="you_have_no_rights_to_install_software_but_you_can_run_jobs_high_performance_computing"><a href="#you_have_no_rights_to_install_software_but_you_can_run_jobs_high_performance_computing" class="header-anchor">You have no rights to install software but you can run jobs &#40;High Performance Computing&#41;</a></h2>
<p>When you have a massive workload that requires a multitude of CPUs, GPUs, or simply runs for quite a long time you do not want to do this on your own computer as it will limit your work experience significantly for everything else.  Here dedicated servers or High Performance Computing infrastructure becomes useful as it can provide you with these resources.  On most of these systems you will not be allowed to install software randomly and the admins will also not be able to provide you with every wish. </p>
<h2 id="you_need_to_share_your_software_but_how"><a href="#you_need_to_share_your_software_but_how" class="header-anchor">You need to share your software but how?</a></h2>
<p>Let us assume you created some nice data processing pipeline and you want to make it available to others.  Sure everybody can install the same environment that you have and run the code but you will get a lot of calls because something is not working.  Often the colleagues work on other operating systems and you barely know how you got it to run on your machine. </p>
<h2 id="you_need_to_archive_a_working_version_limited"><a href="#you_need_to_archive_a_working_version_limited" class="header-anchor">You need to archive a working version &#40;limited&#41;</a></h2>
<p>This is something that you already came across in the context of <em>git</em> but let us consider you have some old data that can only be processed with a specific version of your software, how do you keep that software alive over a long period of time?</p>
<h2 id="legacy_code_on_old_os"><a href="#legacy_code_on_old_os" class="header-anchor">Legacy code on old OS</a></h2>
<p>Maybe you have some code that is only working on some old operating system but from a security point of view you can no longer run this system for your daily work and you only need it for some specific task that you need maybe once a month.</p>
<p>In the above scenarios &#40;and more&#41; virtualisation or containerisation can help.  So what is this and what are the differences?</p>
<h1 id="virtualisation_and_containerisation"><a href="#virtualisation_and_containerisation" class="header-anchor">Virtualisation and containerisation</a></h1>
<p>Your computer or <em>physical machine</em> is organised approximately like in the the following image: 
<figure style="text-align:center;">
<img src="/ws22-ulg-python-git-docker/assets/pages/docker/physical_machine.svg" style="padding:0; " alt=" Organisation of process on a machine."/>
<figcaption> Organisation of process on a machine.</figcaption>
</figure>
</p>
<p>As virtualisation and containerisation is something that lives next to this the prefix <em>host</em> is used to make sure everybody knows what we are talking about. </p>
<p>Starting from the bottom you have some hardware. This is your CPU, various levels and layers of storage, your network device, keyboard, monitor, and so forth. </p>
<p>The <em>host kernel</em> is mainly the operating system.  It provides you with a standardized interface to the hardware so you do not need to use different programs depending on the brand of monitor you use. </p>
<p>The <em>host process</em> is what you mainly interface with on a computer. This could be MS Word, you favourite internet browser or music player, in short applications are made up of processes. </p>
<h2 id="virtualisation"><a href="#virtualisation" class="header-anchor">Virtualisation</a></h2>
<p>Now you can run some virtualisation on your machine. As the name suggests it will provide a virtual environment.  For example <a href="https://www.virtualbox.org/">Virtual Box</a> is a widely used way to bring Linux to your Windows machine or the other way around. This way you only need set of hardware but have the possibilities of different operation systems available to you.  This looks something like the following: 
<figure style="text-align:center;">
<img src="/ws22-ulg-python-git-docker/assets/pages/docker/virtual_machine.svg" style="padding:0; " alt=" Organisation of process within a virtual machine."/>
<figcaption> Organisation of process within a virtual machine.</figcaption>
</figure>
</p>
<p>From the view of the <em>host</em> the entire virtualisation is one &#40;or more&#41; <em>guest processes</em>, illustrated above by the 
<span style="color: #087f5b"> green box</span>
. </p>
<p>The <em>
<span style="color: #e67700"> hypervisor</span>
</em> is translating between the <em>host kernel</em> and the virtual hardware that is needed for the <em>
<span style="color: #e67700"> guest kernel</span>
</em>. This means, the <em>guest kernel</em> is seeing its own set of hardware &#40;CPU, GPU, Keyboard, and so forth&#41;.  Quite often you can for example decide if a connected USB Drive is used by the guest or the host.  On top of the <em>hypervisor</em> everything is the same as on the host.  This also means you use up resources to provide this. </p>
<h2 id="containerisation"><a href="#containerisation" class="header-anchor">Containerisation</a></h2>
<p>Now containerisation is a operating system based virtualisation. </p>
<p>
<figure style="text-align:center;">
<img src="/ws22-ulg-python-git-docker/assets/pages/docker/container_machine.svg" style="padding:0; " alt=" Organisation of process within a container."/>
<figcaption> Organisation of process within a container.</figcaption>
</figure>
 You have a specific <em>
<span style="color: #e67700"> runtime</span>
</em> but not a second kernel.  The runtime takes care of the separation on the level of namespaces.  We only discuss Linux containers in this detail and do not guarantee that Windows containers use a different mechanism.  Namespaces are a mechanism of the kernel that separates or <em>partitions</em> resources such that different processes use different set of resources.  For examples, the container might only see 4 of your 16 CPUs, no network drive, can only use 2 GB of main storage and so forth.  This separation also makes sure that there is no leakage of information from one process to the other.  You can also have a different set of rights or run as a different user.  Other than with a virtualisation the <em>host kernel</em> is used and also the <em>host hardware</em> if is allowed via the namespace configuration. </p>
<h1 id="different_container_solutions"><a href="#different_container_solutions" class="header-anchor">Different container solutions</a></h1>
<p>The containerisation started with <a href="https://docs.docker.com/">Docker</a>.  Nowadays, there are a different solutions available with a different focus and different set of functionalities:</p>
<ol>
<li><p><a href="https://opencontainers.org/">Open Container Initiative</a> for example <a href="https://podman.io/">Podman</a></p>
<ul>
<li><p>open industry standards for container format &amp; runtime</p>
</li>
<li><p>Allows for a daemon-less container engine for running OCI containers &#40;root or rootless&#41;</p>
</li>
</ul>
</li>
<li><p><a href="https://apptainer.org/">AppTainer</a> - formally know as Singularity.</p>
<ul>
<li><p>designed for HPC</p>
</li>
<li><p>uses Linux namespaces but leaves resource limitations to the batch system</p>
</li>
<li><p>feels like running a program</p>
</li>
<li><p>allows access to <em>all</em> host resources</p>
</li>
<li><p>runs in the user namespace</p>
</li>
</ul>
</li>
<li><p><a href="https://docs.docker.com/">Docker</a></p>
<ul>
<li><p>based on Linux namespaces and resource limitations</p>
</li>
<li><p>client server model &#40;<em>dockerd</em>&#41;</p>
</li>
<li><p>typical <em>microservices</em> &#40;see <a href="https://docs.docker.com/compose/">docker-compose</a> for a swarm&#41;</p>
</li>
<li><p>very popular with a huge collection on dockerhub</p>
</li>
</ul>
</li>
</ol>
<p>If you want to fully understand what a container actually is it is very instructive to have a look at this video by <a href="https://www.lizrice.com/">Liz Rice</a> <em>Learn how to code a container using Go code</em> 
<iframe width="560" height="315" src="https://www.youtube.com/embed/8fi7uSYlOdc" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>
</p>
<p>Our focus will be on Docker. </p>
<div class="page-foot">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a>  <a href="https://orcid.org/0000-0003-3601-0852">Peter Kandolf</a>. Last modified: January 19, 2024.
    Website built with <a href="https://github.com/tlienart/Franklin.jl">Franklin.jl</a> and the <a href="https://julialang.org">Julia programming language</a>.
</div>
</div><!-- CONTENT ENDS HERE -->
    </div> <!-- end of class main-content -->
    </div> <!-- end of class main-content-wrap -->
    </div> <!-- end of class page-wrap-->
    
    
      


      <script>
    (function(){
    
      // Get the elements.
      // - the 'pre' element.
      // - the 'div' with the 'paste-content' id.
    
      var pre = document.getElementsByTagName('pre');
    
      // Add a copy button in the 'pre' element.
      // which only has the className of 'language-'.
    
      for (var i = 0; i < pre.length; i++) {
        var isLanguage = pre[i].children[0].tagName == 'CODE';
    
        if ( isLanguage ) {
          var button           = document.createElement('button');
              button.className = 'copy-button';
              button.textContent = 'Copy';
    
              pre[i].appendChild(button);
        }
      };
    
      // Run Clipboard
    
      var copyCode = new Clipboard('.copy-button', {
        target: function(trigger) {
          return trigger.previousElementSibling;
        }
      });
    
      // On success:
      // - Change the "Copy" text to "Copied".
      // - Swap it to "Copy" in 2s.
      // - Lead user to the "contenteditable" area with Velocity scroll.
    
      copyCode.on('success', function(event) {
        event.clearSelection();
        event.trigger.textContent = 'Copied';
        window.setTimeout(function() {
          event.trigger.textContent = 'Copy';
        }, 2000);
    
      });
    
      // On error (Safari):
      // - Change the  "Press Ctrl+C to copy"
      // - Swap it to "Copy" in 2s.
    
      copyCode.on('error', function(event) {
        event.trigger.textContent = 'Press "Ctrl + C" to copy';
        window.setTimeout(function() {
          event.trigger.textContent = 'Copy';
        }, 5000);
      });
    
    })();
</script>
    
  </body>
</html>

<script>
  var coll = document.getElementsByClassName("collapsible");
  var i;

  for (i = 0; i < coll.length; i++) {
    coll[i].addEventListener("click", function() {
      this.classList.toggle("active");
      var content = this.nextElementSibling;
      if (content.style.display === "block") {
        content.style.display = "none";
      } else {
        content.style.display = "block";
      }
    });
  }
</script>

<script>
  var coll = document.getElementsByClassName("solutioncollapsible");
  const queryString = window.location.search;
  const urlParams = new URLSearchParams(queryString);
  const myVar = urlParams.get('solution')
  if ( myVar == 'true') {
    for (i = 0; i < coll.length; i++) {
      coll[i].style.display = "block";
    }
  }
</script>